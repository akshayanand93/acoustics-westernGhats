---
title: "04-ordination-NMDS-analysis"
output: html_document
---

This script is for site-wise (Benchmark, Actice and Passive sites) species composition ordination analysis for the 2020_summer_annotated data.


Install required packages
```{r}
library(tidyverse)
library(dplyr)
library(stringr)
library(vegan)
library(tidyr)
library("ggplot2")
library("iNEXT")
```

First step is to Sort the df from the annotated datasheet for running ordination (NMDS) analysis.

```{r}
#Attach the 2020_summer_annotation data 
data <- read.csv("D:\\VR-Project\\VR_Annotation\\Ordination(NMDS) Analysis\\2020-summer-annotation-working document.csv")
data
```


#Site-wise (4 minute) sorting 
```{r}
#Split the Filenames into 4 columns : Site, Date, Time and Splits   
data1 <- separate(data, col = Filename, into = c("Site", "Date", "Time", "Splits"), sep = "_")

#combine columns before grouping
data1$site_date <- paste(data1$Site, data1$Date, sep="_")
data1$site_date

```

```{r}

data2 <-data1 %>%group_by(site_date, Restoration.Type..Benchmark.Active.Passive.)%>%
summarise_at(.vars = vars(c("IP":"CR")),
.funs = sum)%>%transform() 
as.numeric(data1$GJ>0)
norm<-function(x)as.numeric(x>0)
data2 <- as.data.frame(unclass(data2))
data2

```

```{r}
#Species detections per site across multiple visits
data3 <- separate(data2, col = site_date, into = c("Site", "Date"), sep = "_")

data4 <- cbind(data3["Site"], apply(data3[4:109],2, function(x){as.numeric(x>0)}))
data4[is.na(data4)] <- 0
data4

```


```{r}
#overall species richness 
#sum up the number of non-zero entries per row 
#the first column is ignored [, -1] as it is the site name (not a species count)

library(plyr)
data5 <- ddply(data4, ~Site, function(x) {
  data.frame(RICHNESS=sum(x[,-1]>0))
})

data5
```

```{r}
#subset the data for species accumulation curve
df1 <- data3[, 2:107]

spec.accu <- specaccum(df1, "random", permutations = 100)
plot(spec.accu)


#subset each habitat into its own df
data3 %>% filter (Restoration.Type..Benchmark.Active.Passive. == "Benchmark") -> Benchmark
data3 %>% filter (Restoration.Type..Benchmark.Active.Passive. == "Passive") -> Passive
data3 %>% filter (Restoration.Type..Benchmark.Active.Passive. == "Active") -> Active

#calculate spec.accu curve for each habitat
curve_Benchmark =specaccum(Benchmark[, 2:107], method = "random")
curve_Passive =specaccum(Passive[, 2:107], method = "random")
curve_Active =specaccum(Active[, 2:107], method = "random")


#plot all spec.accu curve first
plot(spec.accu)
#then plot the rest
plot(curve_Benchmark, add =TRUE, col = "red" )
plot(curve_Passive, add = TRUE, col = "blue")
plot(curve_Active, add = TRUE, col = "green")
```



```{r}


```



```{r}


```


```{r}


```

```{r}

```


```{r}



```



```{r}



```




```{r}



```




```{r}
#subset the sorted dataframe on which to base the ordination
df1 <- dataNMDS[,2:107]

## THe column contains the descriptive data
df2 <- dataNMDS[, 1:1]
df2


```



```{r}
#Ordination by NMDS
NMDS <- metaMDS(df1, distance = "bray", k=2)



```








                
                
                
                
                
                
                
                
                
                
                
                
                

