---
title: "04-ordination-NMDS-analysis"
output: html_document
---

This script is for site-wise (Benchmark, Actice and Passive sites) species composition ordination analysis for the 2020_summer_annotated data.


Install required packages
```{r}
library(tidyverse)
library(dplyr)
library(stringr)
library(vegan)
library(tidyr)
```

First step is to Sort the df from the annotated datasheet for running ordination (NMDS) analysis.

```{r}
#Attach the 2020_summer_annotation data 
data <- read.csv("D:\\VR-Project\\VR_Annotation\\Ordination(NMDS) Analysis\\2020-summer-annotation-working document.csv")
data
```


#Site-wise (4 minute) sorting 
```{r}
#Split the Filenames into 4 columns : Site, Date, Time and Splits   
data1 <- separate(data, col = Filename, into = c("Site", "Date", "Time", "Splits"), sep = "_")

#combine columns before grouping
data1$site_date_time <- paste(data1$Site, data1$Date, data1$Time, sep="_")
data1$site_date_time

```

```{r}
data2 <-data1 %>%group_by(site_date_time, Restoration.Type..Benchmark.Active.Passive.)%>%
summarise_at(.vars = vars(c("IP":"CR")),
.funs = sum)%>%transform() 
as.numeric(data1$GJ>0)
norm<-function(x)as.numeric(x>0)
data2

```

```{r}
dataNMDS <- cbind(data2[ "Restoration.Type..Benchmark.Active.Passive."], apply(data2[3:108],2, function(x){as.numeric(x>0)}))
dataNMDS[is.na(dataNMDS)] <- 0
dataNMDS
##write.csv(dataNMDS, "D:\\VR-Project\\VR_Annotation\\Ordination(NMDS) Analysis\\dataNMDS.csv")
```


```{r}
#subset the sorted dataframe on which to base the ordination
df1 <- dataNMDS[,2:107]

## THe column contains the descriptive data
df2 <- dataNMDS[, 1:1]
df2
```

```{r}
#Ordination by NMDS
NMDS <- metaMDS(df1, distance = "bray", k=2)

```



```{r}
#Data visualization
#install.packages("ggplot2")
library("ggplot2")

```



```{r}

#Extract the axes (x and Y) scores
datascores <- as.data.frame(scores(NMDS))

```


```{r}

#Add/Calculate spider diagram
scores <- cbind(as.data.frame(datascores), Restoration = df2["Restoration.Type..Benchmark.Active.Passive."])
centroids <- aggregate(cbind(NMDS1, NMDS2) ~ Restoration, data = scores, FUN = mean)
seg <- merge(scores, setNames(centroids, c('REstoration','oNMDS1','oNMDS2')),
             by = 'Restoration', sort = FALSE)

```

```{r}
#plot
ggplot(scores, aes(x=NMDS1, y= NMDS2, colour = Restoration))

```


```{r}



```



```{r}



```




```{r}



```




```{r}



```



```{r}



```








                
                
                
                
                
                
                
                
                
                
                
                
                

